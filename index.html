

<html><head><base href="https://websim.ai/c/TVSllkdVIpSvofoDv%20quiero%20que%20mejores%20la%20interfaz%20de%20esta%20aplicacion%20que%20parezca%20muy%20profesional">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de fichajes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
 <style>
        body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #f7f9fc, #e0e5ef);
    color: #333; /* Texto oscuro para mejor legibilidad */
    margin: 0;
    padding: 0;
    font-size: 16px; /* Tamaño de fuente base */
    line-height: 1.5; /* Espaciado entre líneas */
}

.container {
    max-width: 900px;
    margin: 30px auto;
    padding: 0 20px;
}

.card {
    border: none;
    border-radius: 10px; /* Esquinas redondeadas modernas */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); /* Sombra sutil */
    background-color: #ffffff;
    margin-bottom: 20px;
    overflow: hidden;
    transition: all 0.3s ease; /* Transición suave */
}

.card:hover {
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
    transform: translateY(-4px) scale(1.02); /* Efecto de escala sutil */
}

.card-body {
    padding: 20px;
}

.btn {
    display: inline-block;
    padding: 8px 16px;
    font-size: 14px;
    font-weight: 500;
    text-align: center;
    border-radius: 5px; /* Esquinas redondeadas */
    border: none;
    color: #ffffff;
    cursor: pointer;
    transition: all 0.3s ease; /* Transición suave */
    text-decoration: none; /* Eliminar subrayado de enlaces */
    text-transform: uppercase; /* Texto en mayúsculas para un aspecto más audaz */
    margin: 3px; /* Margen blanco alrededor del botón */
}

.btn-primary {
    background: linear-gradient(145deg, #007bff, #0056b3); /* Fondo con degradado */
}

.btn-primary:hover {
    background: linear-gradient(145deg, #0056b3, #003d7a);
    transform: scale(1.05); /* Escalar ligeramente en hover */
}

.btn-danger {
    background: linear-gradient(145deg, #dc3545, #c82333); /* Fondo con degradado */
}

.btn-danger:hover {
    background: linear-gradient(145deg, #c82333, #a71d2a);
    transform: scale(1.05); /* Escalar ligeramente en hover */
}

.btn-success {
    background: linear-gradient(145deg, #28a745, #218838); /* Fondo con degradado */
}

.btn-success:hover {
    background: linear-gradient(145deg, #218838, #1e7e34);
    transform: scale(1.05); /* Escalar ligeramente en hover */
}

.btn-sm {
    padding: 4px 12px; /* Relleno más pequeño */
    font-size: 12px; /* Tamaño de fuente más pequeño */
    border-radius: 4px; /* Esquinas redondeadas más pequeñas */
}

.me-2 {
    margin-right: 0.5rem; /* Margen pequeño para espaciado */
}

.modal-content {
    border-radius: 10px;
    padding: 20px;
    background: #ffffff;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}

.btn:active,
.btn:focus {
    outline: none; /* Eliminar contorno de enfoque predeterminado */
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.2); /* Contorno personalizado de enfoque */
}

@media (max-width: 768px) {
    .container {
        padding: 0 10px;
    }
}

@media (max-width: 576px) {
    .container {
        padding: 0 15px;
    }
}

    </style>
    </head>
    <body>
    <div class="container">
        <h1 class="text-center mb-4">Gestión de Empresas y Empleados</h1>
        <div class="d-flex justify-content-center mb-4">
            <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addCompanyModal">Agregar Empresa</button>
            <button class="btn btn-success" onclick="showCompanies()">Ver Empresas</button>
        </div>
        <div id="companiesList" class="row"></div>
    </div>
    
    <!-- Modal para agregar empresa -->
    <div class="modal fade" id="addCompanyModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Empresa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCompanyForm">
                        <div class="mb-3">
                            <label for="companyName" class="form-label">Nombre de la Empresa</label>
                            <input type="text" class="form-control" id="companyName" required>
                        </div>
                        <div class="mb-3">
                            <label for="companyCif" class="form-label">CIF</label>
                            <input type="text" class="form-control" id="companyCif" required>
                        </div>
                        <div class="mb-3">
                            <label for="companyAddress" class="form-label">Dirección</label>
                            <input type="text" class="form-control" id="companyAddress" required>
                        </div>
                        <div class="mb-3">
                            <label for="companyPostalCode" class="form-label">Código Postal</label>
                            <input type="text" class="form-control" id="companyPostalCode" required>
                        </div>
                        <div class="mb-3">
                            <label for="companyCity" class="form-label">Ciudad</label>
                            <input type="text" class="form-control" id="companyCity" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="addCompany()">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para agregar empleado -->
    <div class="modal fade" id="addEmployeeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Empleado</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addEmployeeForm">
                        <input type="hidden" id="employeeCompanyId">
                        <div class="mb-3">
                            <label for="employeeName" class="form-label">Nombre del Empleado</label>
                            <input type="text" class="form-control" id="employeeName" required>
                        </div>
                        <div class="mb-3">
                            <label for="employeeDni" class="form-label">DNI</label>
                            <input type="text" class="form-control" id="employeeDni" required>
                        </div>
                        <div class="mb-3">
                            <label for="employeeSsn" class="form-label">Número de Seguridad Social</label>
                            <input type="text" class="form-control" id="employeeSsn" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Horarios</label>
                            <div id="scheduleInputs">
                                <!-- Los inputs de horario se generarán dinámicamente aquí -->
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="addEmployee()">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para editar horario -->
    <div class="modal fade" id="editScheduleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Horario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editScheduleForm">
                        <input type="hidden" id="editEmployeeId">
                        <div id="editScheduleInputs">
                            <!-- Los inputs de horario se generarán dinámicamente aquí -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="saveEditedSchedule()">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para agregar vacaciones -->
    <div class="modal fade" id="addVacationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar Vacaciones</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addVacationForm">
                        <input type="hidden" id="vacationEmployeeId">
                        <div class="mb-3">
                            <label for="vacationStart" class="form-label">Fecha de inicio</label>
                            <input type="text" class="form-control" id="vacationStart" required>
                        </div>
                        <div class="mb-3">
                            <label for="vacationEnd" class="form-label">Fecha de fin</label>
                            <input type="text" class="form-control" id="vacationEnd" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="addVacation()">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para ver vacaciones -->
    <div class="modal fade" id="viewVacationsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Vacaciones</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul id="vacationsList" class="list-group">
                        <!-- La lista de vacaciones se generará dinámicamente aquí -->
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para generar fichajes -->
    <div class="modal fade" id="generateChecksModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Generar Fichajes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="generateChecksForm">
                        <input type="hidden" id="checksEmployeeId">
                        <div class="mb-3">
                            <label for="checksStart" class="form-label">Fecha de inicio</label>
                            <input type="text" class="form-control" id="checksStart" required>
                        </div>
                        <div class="mb-3">
                            <label for="checksEnd" class="form-label">Fecha de fin</label>
                            <input type="text" class="form-control" id="checksEnd" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="generateChecks()">Generar PDF</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <script>
    let firmaenpdf = 'Clauuuuuu'

    let companies = JSON.parse(localStorage.getItem('companies')) || [];
    
    function saveCompanies() {
        localStorage.setItem('companies', JSON.stringify(companies));
    }
    
    function addCompany() {
        const name = document.getElementById('companyName').value;
        const cif = document.getElementById('companyCif').value;
        const address = document.getElementById('companyAddress').value;
        const postalCode = document.getElementById('companyPostalCode').value;
        const city = document.getElementById('companyCity').value;
    
        const newCompany = {
            id: Date.now(),
            name,
            cif,
            address,
            postalCode,
            city,
            employees: []
        };
    
        companies.push(newCompany);
        saveCompanies();
        showCompanies();
        document.getElementById('addCompanyForm').reset();
        bootstrap.Modal.getInstance(document.getElementById('addCompanyModal')).hide();
    }
    
    function showCompanies() {
        const companiesList = document.getElementById('companiesList');
        companiesList.innerHTML = '';
    
        companies.forEach(company => {
            const companyCard = document.createElement('div');
            companyCard.className = 'col-md-6 mb-4';
            companyCard.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">${company.name}</h5>
                        <p class="card-text">CIF: ${company.cif}</p>
                        <p class="card-text">Dirección: ${company.address}</p>
                        <p class="card-text">CP: ${company.postalCode}</p>
                        <p class="card-text">Ciudad: ${company.city}</p>
                        <button class="btn btn-primary btn-sm me-2" onclick="showEmployees(${company.id})">Ver Empleados</button>
                        <button class="btn btn-success btn-sm me-2" onclick="showAddEmployeeModal(${company.id})">Agregar Empleado</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCompany(${company.id})">Eliminar Empresa</button>
                    </div>
                </div>
            `;
            companiesList.appendChild(companyCard);
        });
    }
    
    function deleteCompany(companyId) {
        if (confirm('¿Estás seguro de que quieres eliminar esta empresa?')) {
            companies = companies.filter(company => company.id !== companyId);
            saveCompanies();
            showCompanies();
        }
    }
    
    function showAddEmployeeModal(companyId) {
        document.getElementById('employeeCompanyId').value = companyId;
        generateScheduleInputs();
        const modal = new bootstrap.Modal(document.getElementById('addEmployeeModal'));
        modal.show();
    }
    
    function generateScheduleInputs() {
        const scheduleInputs = document.getElementById('scheduleInputs');
        scheduleInputs.innerHTML = '';
        const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
        
        days.forEach(day => {
            const dayInput = document.createElement('div');
            dayInput.className = 'mb-2';
            dayInput.innerHTML = `
                <label class="form-label">${day}</label>
                <div class="input-group">
                    <input type="text" class="form-control schedule-input" placeholder="Entrada" data-day="${day}" data-type="start">
                    <input type="text" class="form-control schedule-input" placeholder="Salida" data-day="${day}" data-type="end">
                </div>
            `;
            scheduleInputs.appendChild(dayInput);
        });
    
        // Inicializar Flatpickr en los inputs de horario
        flatpickr('.schedule-input', {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            time_24hr: true
        });
    }
    
    function addEmployee() {
        const companyId = parseInt(document.getElementById('employeeCompanyId').value);
        const name = document.getElementById('employeeName').value;
        const dni = document.getElementById('employeeDni').value;
        const ssn = document.getElementById('employeeSsn').value;
    
        const schedule = {};
        const scheduleInputs = document.querySelectorAll('.schedule-input');
        scheduleInputs.forEach(input => {
            const day = input.dataset.day;
            const type = input.dataset.type;
            if (!schedule[day]) schedule[day] = {};
            schedule[day][type] = input.value;
        });
    
        const newEmployee = {
            id: Date.now(),
            name,
            dni,
            ssn,
            schedule,
            vacations: []
        };
    
        const companyIndex = companies.findIndex(company => company.id === companyId);
        if (companyIndex !== -1) {
            companies[companyIndex].employees.push(newEmployee);
            saveCompanies();
            showEmployees(companyId);
            document.getElementById('addEmployeeForm').reset();
            bootstrap.Modal.getInstance(document.getElementById('addEmployeeModal')).hide();
        }
    }
    
    function showEmployees(companyId) {
        const company = companies.find(company => company.id === companyId);
        if (!company) return;
    
        const companiesList = document.getElementById('companiesList');
        companiesList.innerHTML = `
            <div class="col-12 mb-4">
                <h2>${company.name} - Empleados</h2>
                <button class="btn btn-primary mb-3" onclick="showCompanies()">Volver a Empresas</button>
            </div>
        `;
    
        company.employees.forEach(employee => {
            const employeeCard = document.createElement('div');
            employeeCard.className = 'col-md-6 mb-4';
            employeeCard.innerHTML = `
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">${employee.name}</h5>
                        <p class="card-text">DNI: ${employee.dni}</p>
                        <p class="card-text">NSS: ${employee.ssn}</p>
                        <button class="btn btn-primary btn-sm me-2" onclick="showEditScheduleModal(${companyId}, ${employee.id})">Editar Horario</button>
                        <button class="btn btn-success btn-sm me-2" onclick="showAddVacationModal(${companyId}, ${employee.id})">Agregar Vacaciones</button>
                        <button class="btn btn-info btn-sm me-2" onclick="showViewVacationsModal(${companyId}, ${employee.id})">Ver Vacaciones</button>
                        <button class="btn btn-warning btn-sm me-2" onclick="showGenerateChecksModal(${companyId}, ${employee.id})">Generar Fichajes</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteEmployee(${companyId}, ${employee.id})">Eliminar Empleado</button>
                    </div>
                </div>
            `;
            companiesList.appendChild(employeeCard);
        });
    }
    
    function deleteEmployee(companyId, employeeId) {
        if (confirm('¿Estás seguro de que quieres eliminar este empleado?')) {
            const companyIndex = companies.findIndex(company => company.id === companyId);
            if (companyIndex !== -1) {
                companies[companyIndex].employees = companies[companyIndex].employees.filter(employee => employee.id !== employeeId);
                saveCompanies();
                showEmployees(companyId);
            }
        }
    }
    
    function showEditScheduleModal(companyId, employeeId) {
        const company = companies.find(company => company.id === companyId);
        const employee = company.employees.find(employee => employee.id === employeeId);
        
        document.getElementById('editEmployeeId').value = employeeId;
        
        const editScheduleInputs = document.getElementById('editScheduleInputs');
        editScheduleInputs.innerHTML = '';
        
        const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
        
        days.forEach(day => {
            const dayInput = document.createElement('div');
            dayInput.className = 'mb-2';
            dayInput.innerHTML = `
                <label class="form-label">${day}</label>
                <div class="input-group">
                    <input type="text" class="form-control edit-schedule-input" placeholder="Entrada" data-day="${day}" data-type="start" value="${employee.schedule[day]?.start || ''}">
                    <input type="text" class="form-control edit-schedule-input" placeholder="Salida" data-day="${day}" data-type="end" value="${employee.schedule[day]?.end || ''}">
                </div>
            `;
            editScheduleInputs.appendChild(dayInput);
        });
    
        // Inicializar Flatpickr en los inputs de horario
        flatpickr('.edit-schedule-input', {
            enableTime: true,
            noCalendar: true,
            dateFormat: "H:i",
            time_24hr: true
        });
    
        const modal = new bootstrap.Modal(document.getElementById('editScheduleModal'));
        modal.show();
    }
    
    function saveEditedSchedule() {
        const employeeId = parseInt(document.getElementById('editEmployeeId').value);
        const schedule = {};
        const scheduleInputs = document.querySelectorAll('.edit-schedule-input');
        scheduleInputs.forEach(input => {
            const day = input.dataset.day;
            const type = input.dataset.type;
            if (!schedule[day]) schedule[day] = {};
            schedule[day][type] = input.value;
        });
    
        for (let company of companies) {
            const employeeIndex = company.employees.findIndex(employee => employee.id === employeeId);
            if (employeeIndex !== -1) {
                company.employees[employeeIndex].schedule = schedule;
                saveCompanies();
                showEmployees(company.id);
                bootstrap.Modal.getInstance(document.getElementById('editScheduleModal')).hide();
                break;
            }
        }
    }
    
    function showAddVacationModal(companyId, employeeId) {
        document.getElementById('vacationEmployeeId').value = employeeId;
        
        flatpickr('#vacationStart', {
            dateFormat: "Y-m-d",
        });
        
        flatpickr('#vacationEnd', {
            dateFormat: "Y-m-d",
        });
    
        const modal = new bootstrap.Modal(document.getElementById('addVacationModal'));
        modal.show();
    }
    
    function addVacation() {
        const employeeId = parseInt(document.getElementById('vacationEmployeeId').value);
        const start = document.getElementById('vacationStart').value;
        const end = document.getElementById('vacationEnd').value;
    
        const vacation = { id: Date.now(), start, end };
    
        for (let company of companies) {
            const employeeIndex = company.employees.findIndex(employee => employee.id === employeeId);
            if (employeeIndex !== -1) {
                if (!company.employees[employeeIndex].vacations) {
                    company.employees[employeeIndex].vacations = [];
                }
                company.employees[employeeIndex].vacations.push(vacation);
                saveCompanies();
                showEmployees(company.id);
                document.getElementById('addVacationForm').reset();
                bootstrap.Modal.getInstance(document.getElementById('addVacationModal')).hide();
                break;
            }
        }
    }
    
    function showViewVacationsModal(companyId, employeeId) {
        const company = companies.find(company => company.id === companyId);
        const employee = company.employees.find(employee => employee.id === employeeId);
        
        const vacationsList = document.getElementById('vacationsList');
        vacationsList.innerHTML = '';
        
        if (employee.vacations && employee.vacations.length > 0) {
            employee.vacations.forEach(vacation => {
                const vacationItem = document.createElement('li');
                vacationItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                vacationItem.innerHTML = `
                    ${vacation.start} - ${vacation.end}
                    <div>
                        <button class="btn btn-sm btn-warning me-2" onclick="editVacation(${companyId}, ${employeeId}, ${vacation.id})">Editar</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteVacation(${companyId}, ${employeeId}, ${vacation.id})">Eliminar</button>
                    </div>
                `;
                vacationsList.appendChild(vacationItem);
            });
        } else {
            vacationsList.innerHTML = '<li class="list-group-item">No hay vacaciones registradas</li>';
        }
    
        const modal = new bootstrap.Modal(document.getElementById('viewVacationsModal'));
        modal.show();
    }
    
    function editVacation(companyId, employeeId, vacationId) {
        // Implementar la lógica para editar vacaciones
        console.log(`Editar vacación: Company ${companyId}, Employee ${employeeId}, Vacation ${vacationId}`);
    }
    
    function deleteVacation(companyId, employeeId, vacationId) {
        if (confirm('¿Estás seguro de que quieres eliminar estas vacaciones?')) {
            const companyIndex = companies.findIndex(company => company.id === companyId);
            if (companyIndex !== -1) {
                const employeeIndex = companies[companyIndex].employees.findIndex(employee => employee.id === employeeId);
                if (employeeIndex !== -1) {
                    companies[companyIndex].employees[employeeIndex].vacations = companies[companyIndex].employees[employeeIndex].vacations.filter(vacation => vacation.id !== vacationId);
                    saveCompanies();
                    showViewVacationsModal(companyId, employeeId);
                }
            }
        }
    }
    
    function showGenerateChecksModal(companyId, employeeId) {
        document.getElementById('checksEmployeeId').value = employeeId;
        
        flatpickr('#checksStart', {
            dateFormat: "Y-m-d",
        });
        
        flatpickr('#checksEnd', {
            dateFormat: "Y-m-d",
        });
    
        const modal = new bootstrap.Modal(document.getElementById('generateChecksModal'));
        modal.show();
    }
    
    function generateChecks() {
        const employeeId = parseInt(document.getElementById('checksEmployeeId').value);
        const start = new Date(document.getElementById('checksStart').value);
        const end = new Date(document.getElementById('checksEnd').value);
    
        let company, employee;
        for (let c of companies) {
            employee = c.employees.find(e => e.id === employeeId);
            if (employee) {
                company = c;
                break;
            }
        }
    
        if (!company || !employee) return;
    
        const checks = [];
        for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
            const dayOfWeek = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'][date.getDay()];
            const schedule = employee.schedule[dayOfWeek];
    
            if (schedule && schedule.start && schedule.end) {
                const isVacation = employee.vacations && employee.vacations.some(v => {
                    const vacationStart = new Date(v.start);
                    const vacationEnd = new Date(v.end);
                    return date >= vacationStart && date <= vacationEnd;
                });
    
                if (!isVacation) {
                    const randomStart = new Date(date);
                    const [startHour, startMinute] = schedule.start.split(':');
                    randomStart.setHours(parseInt(startHour), parseInt(startMinute) - Math.floor(Math.random() * 5) - 1);
    
                    const randomEnd = new Date(date);
                    const [endHour, endMinute] = schedule.end.split(':');
                    randomEnd.setHours(parseInt(endHour), parseInt(endMinute) + Math.floor(Math.random() * 4) + 1);
    
                    checks.push({
                        date: new Date(date),
                        start: randomStart,
                        end: randomEnd
                    });
                }
            }
        }
    
        generatePDF(company, employee, checks);
        bootstrap.Modal.getInstance(document.getElementById('generateChecksModal')).hide();
    }
    
    function generatePDF(company, employee, checks) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
    
        // Título
        doc.setFontSize(18);
        doc.text('Registro de Fichajes', 105, 15, null, null, 'center');
    
        // Datos de la empresa
        doc.setFontSize(12);
        doc.text(`Empresa: ${company.name}`, 20, 30);
        doc.text(`CIF: ${company.cif}`, 20, 35);
        doc.text(`Dirección: ${company.address}`, 20, 40);
        doc.text(`CP: ${company.postalCode}, Ciudad: ${company.city}`, 20, 45);
    
        // Datos del empleado
        doc.text(`Empleado: ${employee.name}`, 20, 55);
        doc.text(`DNI: ${employee.dni}`, 20, 60);
        doc.text(`NSS: ${employee.ssn}`, 20, 65);
    
        // Tabla de fichajes
        const tableData = checks.map(check => [
            check.date.toLocaleDateString(),
            check.start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }), // Solo hora y minutos
            check.end.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),   // Solo hora y minutos
            ((check.end - check.start) / 3600000).toFixed(2)
        ]);
    
        doc.autoTable({
            startY: 75,
            head: [['Fecha', 'Entrada', 'Salida']],
            body: tableData,
        });
    
      // Cálculo del total de horas

      const totalHours = checks.reduce((total, check) => {
            return total + (check.end - check.start) / 3600000;
        }, 0);

        const finalY = doc.lastAutoTable.finalY || 75;
        doc.text(`Estos fichajes han sido comprobados por el empleado. Firma : `, 20, finalY + 10);
        

        
        // Guardar el PDF
        doc.save(`Fichajes_${employee.name}_${checks[0].date.toISOString().split('T')[0]}_${checks[checks.length-1].date.toISOString().split('T')[0]}.pdf`);
    }
    
    // Inicializar la aplicación
    showCompanies();
    </script>
    </body>
    </html>
    
